

--------------------
Changes: Initial
--------------------


Starting botpress | Sat  5 Dec 2020 17:19:39 EST

BEFORE MEMORY
rss 182.95 MB
heapTotal 111.84 MB
heapUsed 82.42 MB
external 36.96 MB
Starting warmup | Sat  5 Dec 2020 17:19:50 EST
Warmup done | Sat  5 Dec 2020 17:20:01 EST

GC collected
Snapshot memory
done
Snapshot done | Sat  5 Dec 2020 17:20:14 EST
Sending requests | Sat  5 Dec 2020 17:20:16 EST
Requests done | Sat  5 Dec 2020 17:20:27 EST
Finishing snapshot | Sat  5 Dec 2020 17:20:42 EST

LEAK SIZE: -268.2 kb
Big diff: Object [1093 new] --> 48.04 kb
Big diff: String [827 new] --> 40.3 kb


GC collected

FINAL MEMORY
rss 304.09 MB
heapTotal 74.98 MB
heapUsed 67.58 MB
external 3.83 MB



--------------------
Changes: Changed run script
--------------------


GIT DIFF


diff --git a/memory/run.sh b/memory/run.sh
index 98c5fd490..1d72cdc0e 100755
--- a/memory/run.sh
+++ b/memory/run.sh
@@ -13,6 +13,13 @@ echo "Changes: $changes" >> logs.txt
 echo "--------------------" >> logs.txt
 echo "" >> logs.txt
 echo "" >> logs.txt
+echo "GIT DIFF" >> logs.txt
+echo "" >> logs.txt
+echo "" >> logs.txt
+
+git diff >> logs.txt
+git add -A
+git commit -m "run - $changes"
 
 echo "Starting botpress..."
 echo "Starting botpress | $(date)" >> logs.txt
Starting botpress | Sat  5 Dec 2020 17:24:42 EST

BEFORE MEMORY
rss 215.54 MB
heapTotal 114.18 MB
heapUsed 84.91 MB
external 48.37 MB
Starting warmup | Sat  5 Dec 2020 17:24:52 EST
Warmup done | Sat  5 Dec 2020 17:25:03 EST

GC collected
Snapshot memory
done
Snapshot done | Sat  5 Dec 2020 17:25:16 EST
Sending requests | Sat  5 Dec 2020 17:25:18 EST
Requests done | Sat  5 Dec 2020 17:25:29 EST
Finishing snapshot | Sat  5 Dec 2020 17:25:44 EST

LEAK SIZE: -130.13 kb
Big diff: Object [1090 new] --> 47.91 kb
Big diff: String [997 new] --> 46.04 kb


GC collected

FINAL MEMORY
rss 292.22 MB
heapTotal 75.48 MB
heapUsed 67.52 MB
external 3.83 MB



--------------------
Changes: Run script
--------------------


GIT DIFF


diff --git a/src/bp/core/routers/bots/converse.ts b/src/bp/core/routers/bots/converse.ts
index 0e777799d..f99cc28a9 100644
--- a/src/bp/core/routers/bots/converse.ts
+++ b/src/bp/core/routers/bots/converse.ts
@@ -126,7 +126,7 @@ export class ConverseRouter extends CustomRouter {
 
     if (!parts.includes('nlu')) {
       delete output.nlu
-    }
+    } //
 
     if (!parts.includes('state')) {
       delete output.state
Starting botpress | Sat  5 Dec 2020 17:35:07 EST

BEFORE MEMORY
rss 179.65 MB
heapTotal 108.61 MB
heapUsed 73.64 MB
external 29.94 MB
Starting warmup | Sat  5 Dec 2020 17:35:17 EST
Warmup done | Sat  5 Dec 2020 17:35:29 EST

GC collected
Snapshot memory
done
Snapshot done | Sat  5 Dec 2020 17:35:42 EST
Sending requests | Sat  5 Dec 2020 17:35:44 EST
Requests done | Sat  5 Dec 2020 17:35:55 EST
Finishing snapshot | Sat  5 Dec 2020 17:36:10 EST

LEAK SIZE: 218.16 kb
Big diff: Object [1142 new] --> 50.34 kb
Big diff: String [1104 new] --> 49.73 kb


GC collected

FINAL MEMORY
rss 286.3 MB
heapTotal 74.73 MB
heapUsed 67.54 MB
external 3.83 MB



--------------------
Changes: Not calling converse
--------------------


GIT DIFF


Starting botpress | Sat  5 Dec 2020 17:37:57 EST

BEFORE MEMORY
rss 179.71 MB
heapTotal 108.36 MB
heapUsed 73.52 MB
external 29.86 MB
Starting warmup | Sat  5 Dec 2020 17:38:08 EST
Warmup done | Sat  5 Dec 2020 17:38:19 EST

GC collected
Snapshot memory
done
Snapshot done | Sat  5 Dec 2020 17:38:32 EST
Sending requests | Sat  5 Dec 2020 17:38:34 EST
Requests done | Sat  5 Dec 2020 17:38:45 EST
Finishing snapshot | Sat  5 Dec 2020 17:39:00 EST

LEAK SIZE: -95.38 kb


GC collected

FINAL MEMORY
rss 253.47 MB
heapTotal 71.86 MB
heapUsed 66.36 MB
external 3.81 MB



--------------------
Changes: renderTemplate
--------------------


GIT DIFF


diff --git a/src/bp/core/misc/templating.ts b/src/bp/core/misc/templating.ts
index df1cbfcee..bdcfa3b78 100644
--- a/src/bp/core/misc/templating.ts
+++ b/src/bp/core/misc/templating.ts
@@ -10,8 +10,7 @@ export function renderRecursive(item: TemplateItem, context: any): any {
   } else if (typeof item === 'object') {
     return _.mapValues(item, val => renderRecursive(val, context))
   } else if (typeof item === 'string') {
-    return item
-    // return renderTemplate(item, context)
+    return renderTemplate(item, context)
   } else {
     return item
   }
Starting botpress | Sat  5 Dec 2020 17:43:17 EST

BEFORE MEMORY
rss 181.18 MB
heapTotal 109.11 MB
heapUsed 73.55 MB
external 29.86 MB
Starting warmup | Sat  5 Dec 2020 17:43:28 EST
Warmup done | Sat  5 Dec 2020 17:43:39 EST

GC collected
Snapshot memory
done
Snapshot done | Sat  5 Dec 2020 17:43:52 EST
Sending requests | Sat  5 Dec 2020 17:43:54 EST
Requests done | Sat  5 Dec 2020 17:44:05 EST
Finishing snapshot | Sat  5 Dec 2020 17:44:20 EST

LEAK SIZE: -1.35 mb
Big diff: Object [1066 new] --> 46.81 kb


GC collected

FINAL MEMORY
rss 284.36 MB
heapTotal 74.73 MB
heapUsed 67.54 MB
external 3.83 MB



--------------------
Changes: re-running actions
--------------------


GIT DIFF


diff --git a/src/bp/core/services/action/action-service.ts b/src/bp/core/services/action/action-service.ts
index 38b82a753..7f34ded8d 100644
--- a/src/bp/core/services/action/action-service.ts
+++ b/src/bp/core/services/action/action-service.ts
@@ -307,8 +307,6 @@ export class ScopedActionService {
       process: UntrustedSandbox.getSandboxProcessArgs()
     })
 
-    return this._runWithoutVm(code, { bp: await createForAction(), ...args }, _require)
-
     switch (runType) {
       case 'trusted': {
         // bp is created here because it cannot be created in the Local Action Server thread
Starting botpress | Sat  5 Dec 2020 17:45:27 EST

BEFORE MEMORY
rss 179.71 MB
heapTotal 108.61 MB
heapUsed 73.57 MB
external 29.88 MB
Starting warmup | Sat  5 Dec 2020 17:45:37 EST
Warmup done | Sat  5 Dec 2020 17:45:48 EST

GC collected
Snapshot memory
done
Snapshot done | Sat  5 Dec 2020 17:46:01 EST
Sending requests | Sat  5 Dec 2020 17:46:03 EST
Requests done | Sat  5 Dec 2020 17:46:14 EST
Finishing snapshot | Sat  5 Dec 2020 17:46:29 EST

LEAK SIZE: 219.29 kb
Big diff: Array [143 new] --> 138 kb
Big diff: Object [1142 new] --> 50.31 kb
Big diff: String [1136 new] --> 50.77 kb


GC collected

FINAL MEMORY
rss 301.26 MB
heapTotal 74.98 MB
heapUsed 67.55 MB
external 3.83 MB



--------------------
Changes: CMS removed all clone deep etc
--------------------


GIT DIFF


